@model CafeMenu.Application.Models.ViewModels.CustomerMenuViewModel
@{
    ViewData["Title"] = "Menü";
    Layout = "_CustomerLayout";
}

<div class="row">
    <div class="col-lg-3 col-md-4 mb-4 mb-md-0">
        <div class="category-sidebar">
            <h5 class="mb-3 fw-bold">
                <i class="bi bi-list-ul me-2"></i>Kategoriler
            </h5>
            <a asp-controller="Customer" asp-action="Index" 
               class="category-item @(Model.SelectedCategoryId == null ? "active" : "")">
                <i class="bi bi-grid me-2"></i>Tümü
            </a>
            @foreach (var category in Model.Categories)
            {
                var isSelected = Model.SelectedCategoryId == category.CategoryId;
                var hasChildren = category.Children.Any();
                var isParentSelected = category.Children.Any(c => c.CategoryId == Model.SelectedCategoryId || c.Children.Any(ch => ch.CategoryId == Model.SelectedCategoryId));

                <div class="category-wrapper">
                    <a asp-controller="Customer" asp-action="Index" asp-route-categoryId="@category.CategoryId"
                       class="category-item @(isSelected ? "active" : "") @(hasChildren ? "category-parent" : "")">
                        @if (hasChildren)
                        {
                            <i class="bi bi-folder-fill me-2"></i>
                        }
                        else
                        {
                            <i class="bi bi-tag me-2"></i>
                        }
                        <span class="fw-bold">@category.CategoryName</span>
                    </a>
                    @if (hasChildren)
                    {
                        <div class="category-children @(isSelected || isParentSelected ? "expanded" : "")">
                            @foreach (var child in category.Children)
                            {
                                var isChildSelected = Model.SelectedCategoryId == child.CategoryId;
                                <a asp-controller="Customer" asp-action="Index" asp-route-categoryId="@child.CategoryId"
                                   class="category-item category-child @(isChildSelected ? "active" : "")">
                                    <i class="bi bi-arrow-return-right me-2"></i>@child.CategoryName
                                </a>
                                @if (child.Children.Any())
                                {
                                    foreach (var grandChild in child.Children)
                                    {
                                        var isGrandChildSelected = Model.SelectedCategoryId == grandChild.CategoryId;
                                        <a asp-controller="Customer" asp-action="Index" asp-route-categoryId="@grandChild.CategoryId"
                                           class="category-item category-child category-grandchild @(isGrandChildSelected ? "active" : "")">
                                            <i class="bi bi-arrow-return-right me-2"></i><i class="bi bi-arrow-return-right me-1"></i>@grandChild.CategoryName
                                        </a>
                                    }
                                }
                            }
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <div class="col-lg-9 col-md-8">
        @if (Model.SelectedCategoryId.HasValue && !string.IsNullOrEmpty(Model.SelectedCategoryName))
        {
            <div class="mb-4">
                <h3 class="fw-bold">
                    <i class="bi bi-funnel me-2"></i>Filtre: @Model.SelectedCategoryName
                </h3>
                <p class="text-muted">@Model.Products.Count ürün bulundu</p>
            </div>
        }
        else
        {
            <div class="mb-4">
                <h3 class="fw-bold">Tüm Ürünler</h3>
                <p class="text-muted">@Model.Products.Count ürün bulundu</p>
            </div>
        }

        @if (Model.Products.Any())
        {
            <div class="product-grid">
                @foreach (var product in Model.Products)
                {
                    <div class="product-card">
                        @if (!string.IsNullOrEmpty(product.ImagePath))
                        {
                            <img src="@product.ImagePath" class="product-card-image" alt="@product.ProductName" />
                        }
                        else
                        {
                            <div class="product-card-image-placeholder">
                                <i class="bi bi-image"></i>
                            </div>
                        }
                        <div class="product-card-body">
                            <h5 class="product-card-title">@product.ProductName</h5>
                            <p class="product-card-category">
                                <i class="bi bi-tag-fill me-1"></i>@product.CategoryName
                            </p>
                            
                            @if (product.Properties.Any())
                            {
                                <div class="product-properties">
                                    @foreach (var prop in product.Properties)
                                    {
                                        <span class="property-badge">
                                            <i class="bi bi-info-circle me-1"></i>@prop.Key: @prop.Value
                                        </span>
                                    }
                                </div>
                            }

                            <div class="product-price">
                                <div class="price-primary">
                                    <i class="bi bi-currency-exchange me-1"></i>@product.Price.ToString("N2") ₺
                                </div>
                                @if (Model.CurrencyRates != null && Model.CurrencyRates.UsdRate > 0 && Model.CurrencyRates.EurRate > 0)
                                {
                                    <div class="price-secondary">
                                        <span><i class="bi bi-currency-dollar me-1"></i>@((product.Price / Model.CurrencyRates.UsdRate).ToString("N2"))</span>
                                        <span><i class="bi bi-currency-euro me-1"></i>@((product.Price / Model.CurrencyRates.EurRate).ToString("N2"))</span>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="bi bi-inbox"></i>
                </div>
                <h4>Ürün bulunamadı</h4>
                <p class="text-muted">Bu kategoride henüz ürün bulunmamaktadır.</p>
                <a asp-controller="Customer" asp-action="Index" class="btn btn-customer mt-3">
                    <i class="bi bi-arrow-left me-2"></i>Tüm Ürünleri Görüntüle
                </a>
            </div>
        }
    </div>
</div>


@section Styles {
    <style>
        .category-wrapper {
            margin-bottom: 0.25rem;
        }

        .category-parent {
            font-weight: 600;
        }

        .category-children {
            margin-left: 1.5rem;
            margin-top: 0.25rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .category-children.expanded {
            max-height: 1000px;
        }

        .category-child {
            font-size: 0.9rem;
            padding-left: 1rem;
        }

        .category-grandchild {
            margin-left: 1rem;
            font-size: 0.85rem;
        }

        .category-item.active {
            background-color: var(--customer-primary) !important;
            border-color: var(--customer-primary) !important;
            color: white !important;
        }

        .category-item:hover:not(.active) {
            background-color: var(--customer-bg);
            color: var(--customer-primary);
        }
    </style>
}
