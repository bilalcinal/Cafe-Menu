@using System.Security.Claims
@{
    var user = Context.User;
    var role = user?.FindFirst(ClaimTypes.Role)?.Value;
    var permissions = user?.FindAll("Permission").Select(c => c.Value).ToList() ?? new List<string>();
    var isSuperAdmin = role == "SuperAdmin";
    var hasCategoryView = isSuperAdmin || permissions.Any(p => p.StartsWith("Admin.Category."));
    var hasProductView = isSuperAdmin  || permissions.Any(p => p.StartsWith("Admin.Product."));
    var hasPropertyView = isSuperAdmin  || permissions.Any(p => p.StartsWith("Admin.Property."));
    var hasUserView = isSuperAdmin  || permissions.Any(p => p.StartsWith("Admin.User."));
    var hasRoleView = isSuperAdmin  || permissions.Any(p => p.StartsWith("Admin.Role."));
    var hasTenantView = isSuperAdmin;
    var hasDashboardView = true;
}
<nav class="admin-sidebar" id="adminSidebar">
    <div class="admin-sidebar-brand">
        <h4>
            <i class="bi bi-speedometer2 me-2"></i>Cafe Admin
        </h4>
    </div>
    <ul class="admin-sidebar-nav list-unstyled">
        @if (hasDashboardView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Dashboard" ? "active" : "")" 
                   href="/Admin/Dashboard">
                    <i class="bi bi-speedometer2"></i>
                    <span>Dashboard</span>
                </a>
            </li>
        }
        @if (hasCategoryView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Category" ? "active" : "")" 
                   href="/Admin/Category">
                    <i class="bi bi-folder"></i>
                    <span>Kategoriler</span>
                </a>
            </li>
        }
        @if (hasProductView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Product" ? "active" : "")" 
                   href="/Admin/Product">
                    <i class="bi bi-box"></i>
                    <span>Ürünler</span>
                </a>
            </li>
        }
        @if (hasPropertyView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Property" ? "active" : "")" 
                   href="/Admin/Property">
                    <i class="bi bi-tags"></i>
                    <span>Özellikler</span>
                </a>
            </li>
        }
        @if (hasTenantView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Tenant" ? "active" : "")" 
                   href="/Admin/Tenant">
                    <i class="bi bi-building"></i>
                    <span>Tenantlar</span>
                </a>
            </li>
        }
        @if (hasRoleView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Role" ? "active" : "")" 
                   asp-area="Admin" asp-controller="Role" asp-action="Index">
                    <i class="bi bi-shield-check"></i>
                    <span>Roller</span>
                </a>
            </li>
        }
        @if (hasUserView)
        {
            <li class="nav-item">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "User" ? "active" : "")" 
                   href="/Admin/User">
                    <i class="bi bi-people"></i>
                    <span>Kullanıcılar</span>
                </a>
            </li>
        }
        <li class="nav-item mt-3">
            <a class="nav-link text-danger" href="/Admin/Account/Logout" onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">
                <i class="bi bi-box-arrow-right"></i>
                <span>Çıkış</span>
            </a>
            <form id="logoutForm" method="post" action="/Admin/Account/Logout" style="display: none;">
                @Html.AntiForgeryToken()
            </form>
        </li>
    </ul>
</nav>

